<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Book Layout - Fluid</title>
  <!-- Tailwind CSS Browser Script -->
  <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
</head>
<body class="min-h-screen bg-gray-200 p-4 flex flex-col items-center justify-start">
  <!-- Number of pages + generate -->
  <div class="w-full max-w-md flex flex-col sm:flex-row items-center gap-2 mb-4">
    <label for="pageInput" class="text-gray-700 font-semibold">Number of pages:</label>
    <input
      type="number"
      id="pageInput"
      class="border border-gray-300 rounded p-2 w-full sm:w-auto"
      placeholder="e.g. 10"
      min="1"
      value="10"
    />
    <button
      id="generateBtn"
      class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded"
    >
      Generate
    </button>
  </div>

  <!-- Page dimensions -->
  <div class="w-full max-w-md flex flex-col sm:flex-row items-center gap-2 mb-4">
    <label for="pageWidth" class="text-gray-700 font-semibold">Page Width:</label>
    <input
      type="number"
      id="pageWidth"
      class="border border-gray-300 rounded p-2 w-20"
      value="96"
      min="20"
    />
    <label for="pageHeight" class="text-gray-700 font-semibold">Page Height:</label>
    <input
      type="number"
      id="pageHeight"
      class="border border-gray-300 rounded p-2 w-20"
      value="128"
      min="20"
    />
  </div>

  <!-- Page styling -->
  <div class="w-full max-w-md flex flex-col gap-2 mb-4">
    <div class="flex flex-col sm:flex-row items-center gap-2">
      <label for="pageNumbers" class="text-gray-700 font-semibold">Page #s (comma-separated):</label>
      <input
        type="text"
        id="pageNumbers"
        class="border border-gray-300 rounded p-2 w-40"
        placeholder="e.g. 1,3,5"
      />
    </div>

    <div class="flex flex-col sm:flex-row items-center gap-2">
      <label for="customStyle" class="text-gray-700 font-semibold">CSS Style:</label>
      <input
        type="text"
        id="customStyle"
        class="border border-gray-300 rounded p-2 w-full"
        placeholder="e.g. background: red;"
      />
      <button
        id="applyStyleBtn"
        class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded"
      >
        Apply
      </button>
    </div>
  </div>

  <!-- List of applied styles (to remove) -->
  <div id="stylesList" class="w-full max-w-md mb-4"></div>

  <!-- Container for fluid pages -->
  <div id="pagesContainer" class="flex flex-wrap gap-4 w-full justify-center"></div>

  <script>
    // Input references
    const pageInput = document.getElementById('pageInput');
    const pageWidthInput = document.getElementById('pageWidth');
    const pageHeightInput = document.getElementById('pageHeight');
    const pageNumbersInput = document.getElementById('pageNumbers');
    const customStyleInput = document.getElementById('customStyle');
    const generateBtn = document.getElementById('generateBtn');
    const applyStyleBtn = document.getElementById('applyStyleBtn');
    const pagesContainer = document.getElementById('pagesContainer');
    const stylesList = document.getElementById('stylesList');

    // All input IDs for quick localStorage management
    const inputIds = [
      'pageInput',
      'pageWidth',
      'pageHeight',
      'pageNumbers',
      'customStyle',
    ];

    // We'll store text and styles in localStorage.
    let pageTexts = {}; // pageTexts[pageNumber] = 'content'
    let appliedStyles = []; // array of { id, pages: [1,2], style: 'background: red;' }

    // Load all settings from localStorage or use defaults
    function loadSettingsFromStorage() {
      inputIds.forEach((id) => {
        const savedVal = localStorage.getItem(id);
        if (savedVal !== null) {
          document.getElementById(id).value = savedVal;
        }
      });

      const savedTexts = localStorage.getItem('pageTexts');
      if (savedTexts) {
        pageTexts = JSON.parse(savedTexts);
      }

      const savedStyles = localStorage.getItem('appliedStyles');
      if (savedStyles) {
        appliedStyles = JSON.parse(savedStyles);
      }
    }

    // Save input changes to localStorage
    function saveSetting(event) {
      localStorage.setItem(event.target.id, event.target.value);
    }

    // Save entire pageTexts object to localStorage
    function savePageTexts() {
      localStorage.setItem('pageTexts', JSON.stringify(pageTexts));
    }

    // Save entire appliedStyles array to localStorage
    function saveAppliedStyles() {
      localStorage.setItem('appliedStyles', JSON.stringify(appliedStyles));
    }

    // Generate all pages in a fluid layout
    function generatePages() {
      pagesContainer.innerHTML = '';

      const pageCount = parseInt(pageInput.value, 10) || 0;
      const pageWidth = pageWidthInput.value + 'px';
      const pageHeight = pageHeightInput.value + 'px';

      for (let i = 1; i <= pageCount; i++) {
        const pageEl = document.createElement('div');
        pageEl.className =
          'rounded shadow-md flex items-center justify-center font-semibold';
        pageEl.style.backgroundColor = 'white'; // default color
        pageEl.style.color = '#999'; // default color
        pageEl.style.width = pageWidth;
        pageEl.style.height = pageHeight;
        pageEl.dataset.pageNumber = i;
        pageEl.contentEditable = true;
        // If we have saved text, load it
        pageEl.textContent = pageTexts[i] || i.toString();

        // Save text changes on-the-fly
        pageEl.addEventListener('input', () => {
          pageTexts[i] = pageEl.textContent;
          savePageTexts();
        });

        pagesContainer.appendChild(pageEl);
      }

      // Re-apply styles
      applyAllStyles();
    }

    // Apply a single style object across its pages.
    function applyStyleObject(styleObj) {
      styleObj.pages.forEach((p) => {
        const pageEl = pagesContainer.querySelector(`[data-page-number='${p}']`);
        if (pageEl) {
          pageEl.style.cssText += styleObj.style;
        }
      });
    }

    // Re-apply all styles from the appliedStyles array
    function applyAllStyles() {
      appliedStyles.forEach((styleObj) => {
        applyStyleObject(styleObj);
      });
      renderStylesList();
    }

    // Apply new style from user input
    function applyUserStyle() {
      const styleStr = customStyleInput.value.trim();
      if (!styleStr) return;

      const pageNums = pageNumbersInput.value
        .split(',')
        .map((n) => n.trim())
        .filter((n) => n);
      if (!pageNums.length) return;

      const styleObj = {
        id: Date.now(),
        pages: pageNums,
        style: styleStr,
      };

      appliedStyles.push(styleObj);
      saveAppliedStyles();
      applyStyleObject(styleObj);
      renderStylesList();
    }

    // Remove a previously applied style
    function removeStyle(styleId) {
      appliedStyles = appliedStyles.filter((s) => s.id !== styleId);
      saveAppliedStyles();
      generatePages(); // regenerates pages and reapplies styles
    }

    // Render list of currently applied styles
    function renderStylesList() {
      stylesList.innerHTML = '';

      appliedStyles.forEach((styleObj) => {
        const row = document.createElement('div');
        row.className = 'flex flex-row items-center justify-between mb-2 border-b border-gray-300 pb-2';

        const label = document.createElement('span');
        label.textContent = `Pages: [${styleObj.pages.join(', ')}], Style: "${styleObj.style}"`;
        label.className = 'text-sm';

        const removeBtn = document.createElement('button');
        removeBtn.textContent = 'Remove';
        removeBtn.className = 'text-red-600 hover:text-red-800 ml-4';
        removeBtn.addEventListener('click', () => removeStyle(styleObj.id));

        row.appendChild(label);
        row.appendChild(removeBtn);
        stylesList.appendChild(row);
      });
    }

    // Initialization on DOM load
    document.addEventListener('DOMContentLoaded', () => {
      // Load from localStorage
      loadSettingsFromStorage();

      // Add input listeners to store new values in localStorage
      inputIds.forEach((id) => {
        document.getElementById(id).addEventListener('input', saveSetting);
      });

      // Generate pages
      generatePages();
    });

    // Button listeners
    generateBtn.addEventListener('click', generatePages);
    applyStyleBtn.addEventListener('click', applyUserStyle);
  </script>
</body>
</html>
